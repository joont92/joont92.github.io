---
title: 도커 다루기
date: 2019-06-07 21:07:24
tags:
---

아래는 도커 이미지를 관리하면서 자주 사용하는 명령어들과 그에 대한 간단한 설명이다  
추가적인 명령어나 옵션이 궁금하다면 <https://docs.docker.com/engine/reference/commandline/image/> 를 참조한다  

# docker image build
```sh
$ docker image build [options] 이미지명[:태그명] Dockerfile_경로
```
`Dockerfile`에 기술된 내용을 따라 도커 이미지를 생성하는 명령이다  
> `Dockerfile`이 없다면 도커 이미지를 빌드할 수 없다

## -t 옵션
```sh
$ docker image build -t joont92:latest .
```
도커 이미지에 이름과 태그를 붙이는 것으로 실제 사용에선 거의 필수적으로 쓰인다  
지정한 경로에서 `Dockerfile` 이라는 이름의 파일을 찾고 그 내용을 토대로 이미지를 만든다  

## -f 옵션
```sh
$ docker image build -f Dockerfile_test -t joont92:latest .
```
`Dockerfile`이 아닌 다른 이름을 쓰고 싶을 경우 사용한다  

## --pull 옵션
```sh
$ docker image build --pull=true -t joont92:latest .
```
기본적으로 도커 이미지 빌드 시 `FROM` 인스트럭션에 지정한 이미지를 레지스트리에서 받은 후, 이를 호스트 운영체제 저장해놓고 재사용한다  

즉 아래와 같다  
1. 도커 이미지를 빌드한다
    - `FROM` 인스트럭션의 `test:1.0.0` 이미지를 받고 로컬에 저장해둔다
2. 레지스트리의 `test:1.0.0` 이미지의 내용이 변경되었다
3. 도커 이미지를 다시 빌드한다
    - `FROM` 인스트럭션의 `test:1.0.0`은 이미 로컬에 있으므로 재사용한다
4. 레지스트리의 변경사항이 생성된 이미지에 반영되지 않는다

이런 상황을 대비해 확실히 최신 베이스 이미지를 사용하고 싶다면 `pull=true`를 붙여주면 된다  
> `latest` 태그의 경우 매번 `pull=true`를 붙여줘야하는데, 이러면 빌드 속도가 느려지므로 실무에서는 보통 태그명을 직접 입력한다  

# docker search
```sh
$ docker search [options] 검색_키워드
```
도커 레지스트리에서 이미지를 검색할 때 사용한다  
레지스트리를 따로 설정하지 않았다면 기본적으로 도커 허브가 사용된다  
> **도커 허브(Docker Hub)?**  
> 도커 사 자체에서 관리하는 도커 이미지 레지스트리로, 깃허브처럼 자신의 계정이나 조직 이름으로 리포티저티를 만들고 이미지를 올릴 수 있다  
> 도커 허브에는 이미 매우 많은 리포지터리가 등록되어 있어서, 직접 도커 이미지를 만들 필요없이 만들어놓은 이미지를 간단하게 사용할 수 있다  

```sh
$ docker search mysql
$ docker search --limit 5 mysql # 5건만 검색
```
검색결과는 STARS 순으로 출력된다(깃헙과 동일)  
리포지터리와 이미지는 검색할 수 있으나 태그명까지는 검색할 수 없다  
> 리포지터리 = 네임스페이스 = 계정명? 
> 리포지터리명이라는 말이 왜 갑자기.. 
> 리포지터리와 이미지의 차이가 뭔지?  

# docker image pull
```sh
$ docker image pull [options] 이미지명[:태그명]
```
도커 레지스트리에서 도커 이미지를 내려받을 때 사용한다  
```sh
$ docker image pull jenkins:latest
```
태그명을 생략하면 기본으로 지정된 태그가 사용되는데 대부분 `latest` 이다  

# docker image ls
```sh
$ docker image ls [options] [이미지명[:태그명]]
```
현재 호스트 운영체제에 저장된 도커 이미지의 목록을 보여준다  

참고로 여기서 조회되는 IMAGE ID는 CONTAINER ID와는 별개의 것이므로 주의해야 한다  

# docker image tag
도커는 이미지의 버전을 이미지 ID로 관리한다  
1. docker 파일을 빌드하여 이미지를 만든다  
    ```sh
    $ docker image build -t joont92/test:latest .
    ```
2. docker image ls로 빌드된 이미지가 잘 저장되었는지 확인한다
    ```
    $ docker image ls -a

    REPOSITORY     TAG        IMAGE ID      CREATED      SIZE  
    joont92/test   latest     57ca5e531d73  1 hour ago   4.41MB 
    ```
3. Dockerfile을 조금 수정하고 다시 빌드하고, docker image ls 로 확인해본다
    ```
    $ docker image build -t joont92/test:latest .
    $ docker image ls -a  

    REPOSITORY     TAG        IMAGE ID      CREATED      SIZE  
    joont92/test   latest     57ca5e531d73  1 hour ago   4.40MB 
    <none>         <none>     2327e281c9b2  2 hour ago   4.41MB
    ```
    > IMAGE ID가 다르게 이미지가 새롭게 빌드되었음을 볼 수 있다  
    > 이처럼 Dockerfile을 수정할 때 뿐만 아니라 COPY 되는 대상이 바뀌거나 하여도 새로운 이미지로 빌드된다

`<none>` 이라고 붙은 이미지는 `joont92/test` 이미지의 이전 잔재다  
파일을 수정하고 새로 빌드하면서 동일한 이미지와 태그명을 사용했으므로  
새롭게 빌드된 이미지에 해당 이미지명과 태그명이 매핑되고, 기존 이미지는 이름과 태그가 해제되었기 때문에 `<none>`으로 표시된다  

# docker image push
```sh
$ docker image push [options] 이미지명[:태그]
```

<!-- more -->