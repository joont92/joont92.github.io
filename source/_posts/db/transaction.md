---
title: transaction
date: 2018-01-13 20:22:21
tags:
    - 트랜잭션  
    - 트랜잭션 설정법
---

# 트랜잭션이란
작업을 논리적 단위로 묶어서 원자성(atomic)을 보장하고자 할 때 사용하는 것이다.  
MySQL에서는 InnoDB만 지원하고, 나머지(MyISAM 등)은 트랜잭션을 지원하지 않는다.  

아래와 같은 쿼리가 있다(3번째 멤버가 중복된 이름이라 에러가 발생할 것이다)  

```SQL
INSERT INTO MEMBER VALUES(1,'joont'),(2,'junyoung'),(3,'duplicated name');
```

- MyISAM  
    > 쿼리 실행시에 오류가 발생하지만 3번 멤버만 저장되지 않을 뿐, 1,2번 멤버는 롤백되지 않고 저장된 상태 그대로 있다.  
    > 이러면 나중에 데이터 정합성을 맞추기가 매우 힘들어진다.  
- InnoDB  
    > 1,2,3번 모두 저장되지 않는다.  

위처럼 꼭 여러개의 작업 단위를 묶지 않아도 된다.  
트랜잭션이 성공적으로 수행되면 commit되고, 실패하면 rollback 한다는 사실이 중요한 것이다.  

# 설정법
AutoCommit 모드가 설정되어 있으면 쿼리 문장 하나가 곧 트랜잭션이고,  
여러 쿼리를 묶어 트랜잭션을 설정하고 싶으면 AutoCommit 모드를 false로 설정해줘야 한다.  
설정해주는 시점부터 트랜잭션의 시작이고, commit이나 rollback을 하는 시점이 트랜잭션의 끝이다.  

# 주의점  
트랜잭션의 경우 최소한의 단위로 설정해줘야 한다.  

1. 처리 시작  
2. 전달받은 ID로 회원 조회
3. 

하나의 트랜잭션에 1개 이상의 커넥션이 들어올 수 있음  
이럴경우 해당 커넥션이 발생시킬 수 있는 locking을 신경써줘야 함  
가령 첫번째 커넥션이 하나의 로우에 락을 걸었는데 반환되지 않으면 

<!-- more -->