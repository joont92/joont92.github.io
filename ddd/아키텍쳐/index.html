<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="4개의 영역 아키텍쳐를 설계할 때 출현하는 전형적인 영역은 아래와 같다  표현  HTTP 요청을 응용 영역이 필요로 하는 형식으로 변환해서 응용 영역에 전달하고, 응용 영역의 응답을 HTTP 응답으로 변환해서 전송한다 e.g. 요청 파라미터를 객체로 받고 결과를 JSON으로 리턴   응용  시스템이 사용자에게 제공해야 할 기능을 구현한다   응용 영역은">
<meta name="keywords" content="DDD start!,계층 구조,DIP,DI">
<meta property="og:type" content="article">
<meta property="og:title" content="[ddd] 아키텍쳐">
<meta property="og:url" content="https://joont92.github.io/ddd/아키텍쳐/index.html">
<meta property="og:site_name" content="기록은 기억의 연장선">
<meta property="og:description" content="4개의 영역 아키텍쳐를 설계할 때 출현하는 전형적인 영역은 아래와 같다  표현  HTTP 요청을 응용 영역이 필요로 하는 형식으로 변환해서 응용 영역에 전달하고, 응용 영역의 응답을 HTTP 응답으로 변환해서 전송한다 e.g. 요청 파라미터를 객체로 받고 결과를 JSON으로 리턴   응용  시스템이 사용자에게 제공해야 할 기능을 구현한다   응용 영역은">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://joont92.github.io/temp/%EC%A0%80%EC%88%98%EC%A4%80-%EA%B3%A0%EC%88%98%EC%A4%80-%EC%9D%98%EC%A1%B4.png">
<meta property="og:image" content="https://joont92.github.io/temp/%EC%9E%98%EB%AA%BB%EB%90%9C-DIP.png">
<meta property="og:image" content="https://joont92.github.io/temp/%EC%9B%B9%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%9A%94%EC%B2%AD%EC%B2%98%EB%A6%AC-%ED%9D%90%EB%A6%84.jpeg">
<meta property="og:updated_time" content="2020-11-02T10:09:30.453Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[ddd] 아키텍쳐">
<meta name="twitter:description" content="4개의 영역 아키텍쳐를 설계할 때 출현하는 전형적인 영역은 아래와 같다  표현  HTTP 요청을 응용 영역이 필요로 하는 형식으로 변환해서 응용 영역에 전달하고, 응용 영역의 응답을 HTTP 응답으로 변환해서 전송한다 e.g. 요청 파라미터를 객체로 받고 결과를 JSON으로 리턴   응용  시스템이 사용자에게 제공해야 할 기능을 구현한다   응용 영역은">
<meta name="twitter:image" content="https://joont92.github.io/temp/%EC%A0%80%EC%88%98%EC%A4%80-%EA%B3%A0%EC%88%98%EC%A4%80-%EC%9D%98%EC%A1%B4.png">



  <link rel="alternate" href="/feed.xml" title="기록은 기억의 연장선" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://joont92.github.io/ddd/아키텍쳐/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>[ddd] 아키텍쳐 | 기록은 기억의 연장선</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-110551662-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-110551662-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">기록은 기억의 연장선</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">더 많은 것을 기억하기 위해 기록합니다</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/joont92" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow noopener noreferrer" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joont92.github.io/ddd/아키텍쳐/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JunYoung Park">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="기록은 기억의 연장선">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">[ddd] 아키텍쳐

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-04 00:48:03" itemprop="dateCreated datePublished" datetime="2019-05-04T00:48:03+00:00">2019-05-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-11-02 10:09:30" itemprop="dateModified" datetime="2020-11-02T10:09:30+00:00">2020-11-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/ddd/" itemprop="url" rel="index"><span itemprop="name">ddd</span></a></span>

                
                
              
            </span>
          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/ddd/아키텍쳐/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="ddd/아키텍쳐/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="4개의-영역"><a class="markdownIt-Anchor" href="#4개의-영역"></a> 4개의 영역</h1>
<p>아키텍쳐를 설계할 때 출현하는 전형적인 영역은 아래와 같다</p>
<ul>
<li>표현
<blockquote>
<p>HTTP 요청을 응용 영역이 필요로 하는 형식으로 변환해서 응용 영역에 전달하고, 응용 영역의 응답을 HTTP 응답으로 변환해서 전송한다<br>
e.g. 요청 파라미터를 객체로 받고 결과를 JSON으로 리턴</p>
</blockquote>
</li>
<li>응용
<blockquote>
<p>시스템이 사용자에게 제공해야 할 기능을 구현한다</p>
</blockquote>
<ul>
<li><strong>응용 영역은 기능을 구현하기 위해 도메인 영역의 도메인 모델을 사용한다</strong></li>
<li><strong>응용 서비스는 로직을 직접 수행하기보다는 도메인 모델에 로직 수행을 위임한다</strong></li>
</ul>
</li>
<li>도메인
<blockquote>
<p>도메인의 핵심 로직을 구현한다<br>
e.g. 주문 도메인의 경우 ‘배송지 변경’, ‘결제 완료’ 같은 핵심 로직을 도메인 모델에서 구현한다</p>
</blockquote>
</li>
<li>인프라스트럭쳐
<blockquote>
<p>구현 기술에 대한 것을 다룬다<br>
e.g. RDBMS 연동, 몽고 DB, 메시지 큐 전송 등</p>
</blockquote>
</li>
</ul>
<h1 id="계층-구조-아키텍쳐"><a class="markdownIt-Anchor" href="#계층-구조-아키텍쳐"></a> 계층 구조 아키텍쳐</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   표현</span><br><span class="line">    ↓</span><br><span class="line">   응용</span><br><span class="line">    ↓</span><br><span class="line">   도메인</span><br><span class="line">    ↓</span><br><span class="line">인프라스트럭쳐</span><br></pre></td></tr></table></figure>
<ul>
<li>계층 구조는 상위 계층에서 하위 계층으로의 의존만 존재하고 하위 계층에서 상위 계층에 의존하지는 않는다</li>
<li>계층 구조를 엄격하게 적용하면 상위 계층은 바로 아래 계층에만 의존을 가져야하지만, 구현의 편리함을 위해 계층 구조를 유연하게 적용한다</li>
</ul>
<p>이 말인 즉, <strong>표현, 응용, 도메인 계층이 상세한 구현 기술을 다루는 인프라스트럭쳐에 의존할 수 있다는 점이다</strong><br>
예를 들면 아래처럼 될 수 있다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CalculateDiscountService</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> DroolsRuleEngine ruleEngine = <span class="keyword">new</span> DroolsRuleEngine();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Money <span class="title">calculateDiscount</span><span class="params">(List&lt;OrderLine&gt; orderLines, String customerId)</span> </span>&#123;</span><br><span class="line">        Customer customer = findCustomer(customerId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 초기 돈</span></span><br><span class="line">        MutableMoney money = <span class="keyword">new</span> MutableMoney(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 조건들 추가하고</span></span><br><span class="line">        List&lt;?&gt; facts = Arrays.asList(customer, money);</span><br><span class="line">        facts.addAll(orderLines);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// DroolsRulsEngine을 이용해 할인율 적용</span></span><br><span class="line">        ruleEngine.evaluate(<span class="string">"discountCalculation"</span>, facts);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> money.toImmutableMoney();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>위 처럼 도메인에 메시지를 보내는 것 외에 특정 엔진을 사용해야하는 상황이다<br>
(특정 엔진을 사용하는 것이 더 나은 상황)</p>
</blockquote>
<p>하지만 위 코드는 아래 2가지 문제점을 가지고 있다</p>
<ul>
<li>테스트하기 어렵다
<ul>
<li><code>DroolsRuleEngine</code>이 완벽하게 동작해야만 <code>CalculateDiscountService</code>를 테스트할 수 있다</li>
</ul>
</li>
<li>구현 방식을 변경하기 어렵다
<ul>
<li><code>DroolsRuleEngine</code>이 아니라 다른 엔진을 사용하도록 변경하고자 한다면 많은 부분이 변경되어야 할 것이다</li>
</ul>
</li>
</ul>
<p>고수준 모둘이 제대로 동작하려면 저수준 모듈을 사용해야 하는데, <strong>인프라스트럭쳐의 경우 특정 기술을 직접 구현하므로</strong> 이런 문제점이 발생하게 된다.<br>
이를 어떻게 처리할 수 있을까?</p>
<h1 id="dip"><a class="markdownIt-Anchor" href="#dip"></a> DIP</h1>
<p>정답은 <strong>저수준 모델이 고수준 모델에 의존하도록 바꾸는 것이다</strong><br>
다시 한번 <code>CalculateDiscountService</code>를 살펴보면, discount를 얻는데 어떤 엔진을 사용했느냐는 중요하지 않다<br>
단지 <code>고객정보와 구매정보에 룰을 적용해서 할인 금액을 구한다</code>는 것이 중요할 뿐이다<br>
이 부분을 추상화해서 인터페이스로 만들 수 있다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">RuleDiscounter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Money <span class="title">applyRules</span><span class="params">(Customer customer, List&lt;OrderLine&gt; orderLines)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이 인터페이스를 사용하여 <code>CalculateDiscountService</code>에서 <code>DroolsRuleEngine</code>을 제거할 수 있다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CalculateDiscountService</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> RuleDiscounter ruleDiscounter;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CalculateDiscountService</span><span class="params">(RuleDiscounter ruleDiscounter)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ruleDiscounter = ruleDiscounter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Money <span class="title">calculateDiscount</span><span class="params">(List&lt;OrderLine&gt; orderLines, String customerId)</span> </span>&#123;</span><br><span class="line">        Customer customer = findCustomer(customerId);</span><br><span class="line">        <span class="keyword">return</span> ruleDiscounter.applyRules(customer, orderLines);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DroolsRuleDiscounter</span> <span class="keyword">implements</span> <span class="title">RuleDiscounter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>CalculateDiscountService</code>는 더 이상 구현기술인 <code>Drools</code>(저수준)에 의존하지 않고,<br>
<code>룰을 이용한 할인 금액 계산</code> 을 표현하는 <code>RuleDiscounter</code> 인터페이스(고수준)에 의존한다</p>
<p><img src="/temp/%EC%A0%80%EC%88%98%EC%A4%80-%EA%B3%A0%EC%88%98%EC%A4%80-%EC%9D%98%EC%A1%B4.png" alt="저수준이 고수준에 의존"></p>
<p>그림에서 보이다시피 고수준 모듈이 저수준 모듈을 사용함에도 불구하고 <strong>저수준 모듈이 고수준 모듈에 의존하고 있다</strong><br>
이를 <strong>DIP(Dependency Inversion Principle, 의존 역전 원칙)</strong> 이라고 부른다</p>
<p>그리고 인터페이스를 구현한 저수준 모듈은 외부에서 생성해 주입(Dependency Injection) 해주게 된다</p>
<p>이와 같이 DIP를 적용함으로써 기존의 <code>고수준 모듈에서 저수준 모듈 사용</code>에서 오던 문제점들을 해결할 수 있게 된다</p>
<ol>
<li>테스트하기 쉬워진다
<ul>
<li>특정 클래스가 아니라 인터페이스에 의존하므로 mockito를 사용한 stub 등을 사용한다면 직접 구현체를 구현하지 않고도 테스트를 진행할 수 있게 된다</li>
</ul>
</li>
<li>구현 방식을 변경하기 숴워진다
<ul>
<li>저수준 모듈에 강하게 결합되어 있는 구조가 아니기 때문에, <strong>구현 방식을 변경하고 싶다면 인터페이스를 구현한 구현체를 하나 더 만들어서 DI 해주면 <code>CalculateDiscountService</code>의 코드변경 없이 구현 방식을 변경할 수 있다(OCP)</strong></li>
</ul>
</li>
</ol>
<h2 id="dip-주의사항"><a class="markdownIt-Anchor" href="#dip-주의사항"></a> DIP 주의사항</h2>
<p><img src="/temp/%EC%9E%98%EB%AA%BB%EB%90%9C-DIP.png" alt="잘못된 DIP"></p>
<p>DIP 결과 구조만 보고 인터페이스를 잘못 추출한 결과이다<br>
<strong><code>RuleEngine</code>은 고수준 모델인 도메인 관점이 아니라 엔진이라는 저수준 모듈 관점에서 도출된 것이다</strong><br>
즉, 여전히 고수준 모듈이 저수준 모듈에 의존하고 있는 셈이다</p>
<p>DIP를 적용할 때 하위 기능을 추상화한 인터페이스는 <strong>고수준 모듈 관점에서 도출해야 한다</strong></p>
<h1 id="도메인-영역의-주요-구성요소"><a class="markdownIt-Anchor" href="#도메인-영역의-주요-구성요소"></a> 도메인 영역의 주요 구성요소</h1>
<ol>
<li>엔티티
<blockquote>
<p>고유의 식별자를 가지고 자신의 라이프 사이클을 갖는 객체<br>
데이터와 데이터와 관련된 기능을 함께 제공한다</p>
</blockquote>
</li>
<li>벨류
<blockquote>
<p>고유의 식별자를 갖지 않고 주로 도메인 객체의 속성을 표현할 떄 사용되는 객체<br>
다른 벨류 타입의 속성으로도 사용될 수 있다</p>
</blockquote>
</li>
<li>애그리거트
<blockquote>
<p>관련된 엔티티와 벨류 객체를 개념적으로 하나로 묶은 것</p>
</blockquote>
</li>
<li>리포지터리
<blockquote>
<p>도메인 모델의 영속성을 처리함</p>
</blockquote>
</li>
<li>도메인 서비스
<blockquote>
<p>특정 엔티티에 속하지 않은 도메인 로직을 제공함<br>
도메인 로직이 여러 엔티티와 벨류를 필요로 할 경우 여기에서 로직을 구현한다</p>
</blockquote>
</li>
</ol>
<h2 id="엔티티와-벨류"><a class="markdownIt-Anchor" href="#엔티티와-벨류"></a> 엔티티와 벨류</h2>
<p>도메인 모델의 엔티티와 DB 모델의 엔티티는 다르다</p>
<ul>
<li>도메인 모델의 엔티티는 단순히 데이터를 담고 있는 데이터 구조라기보다는 <strong>데이터와 함께 기능을 제공하는 객체</strong>이다
<ul>
<li>도메인 관점에서 기능을 구현하고 기능 구현을 캡슐화해서 데이터가 임의로 변경되는 것을 막는다</li>
</ul>
</li>
<li>도메인 모델의 엔티티는 두 개 이상의 데이터가 개념적으로 하나인 경우 벨류 타입을 이용해서 표현할 수 있다
<ul>
<li>RDBMS는 벨류를 제대로 표현하기 힘들다
<blockquote>
<p>ORDER_NAME, ORDER_EMAIL 필드로 표시하거나 또는 ORDER_ORDERER 테이블로 표시하더라도 딱히 벨류 타입의 느낌을 주지 못한다</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="애그리거트"><a class="markdownIt-Anchor" href="#애그리거트"></a> 애그리거트</h2>
<p>도메인이 커질수록 개발할 도메인 모델도 커지게 되고, 많은 엔티티와 벨류가 생기면서 모델이 점점 더 복잡해진다<br>
이렇게 도메인 모델이 복잡해지면 개발자가 전체 구조가 아닌 한개 엔티티와 벨류에 집중하게 되는 경우가 발생한다</p>
<p>지도를 볼 때 매우 상세하게 나온 대축적 지도를 보면 큰 수준에서 어디에 위치하고 있는지 이해하기 어려우므로 큰 수준에서 보여주는 소축적 지도를 함꼐 봐야 현재 위치를 보다 더 정확하게 이해할 수 있다<br>
이와 비슷하게 도메인 모델도 개별 객체가 아니라 상위 수준에서 모델을 볼 수 있어야 전체 모델과 개별 모델을 이해하는데 도움이 된다<br>
이게 바로 <strong>애그리거트(AGGREGATE)</strong> 이다</p>
<blockquote>
<p><code>주문</code> 애그리거트는 <code>주문</code>, <code>주문자</code>, <code>배송정보</code> 등을 포함한다</p>
</blockquote>
<p>애그리거트는 군집에 속한 객체들을 관리하는 <strong>루트 엔티티</strong>를 가진다</p>
<ul>
<li>루트 엔티티는 애그리거트에 속해 있는 엔티티와 벨류 객체를 이용해서 애그리거트가 구현해야 할 기능을 제공한다</li>
<li>애그리거트를 사용하는 코드는 애그리거트가 제공하는 기능을 실행하고 애그리거트 루트를 통해서 간접적으로 애그리거트 내의 엔티티나 벨류 객체에 접근하게 된다</li>
</ul>
<p><strong>애그리거트를 구현할 때는 고려할 것이 많다</strong></p>
<h2 id="리포지터리"><a class="markdownIt-Anchor" href="#리포지터리"></a> 리포지터리</h2>
<p>도메인 객체를 지속적으로 사용하려면 RDBMS 같은 물리적 저장소에 도메인 객체를 보관해야 하고, 이를 위한 도메인 모델이 리포지터리 이다</p>
<blockquote>
<p>리포지토리는 애그리거트 단위로 도메인 객체를 조회하고 저장하는 기능을 제공한다</p>
</blockquote>
<p>리포지터리는 도메인 객체를 영속화하는데 필요한 기능을 추상화 한 것이기 떄문에 <strong>고수준 모듈에 속하고</strong>, 실제 구현 클래스는 인프라스트럭쳐 영역에 속한다</p>
<p>리포지터리의 사용 주체는 응용 서비스이다</p>
<ul>
<li>응용 서비스는 필요한 도메인 객체를 구하거나 저장할 때 리포지터리를 이용한다</li>
<li>그러므로 응용 서비스가 필요로 하는 메서드를 제공한다
<ul>
<li>기본은 <code>저장</code>과 <code>식별자로 조회</code> 메서드이다</li>
</ul>
</li>
</ul>
<h1 id="요청-처리-흐름"><a class="markdownIt-Anchor" href="#요청-처리-흐름"></a> 요청 처리 흐름</h1>
<p><img src="/temp/%EC%9B%B9%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EC%9A%94%EC%B2%AD%EC%B2%98%EB%A6%AC-%ED%9D%90%EB%A6%84.jpeg" alt="웹어플리케이션 요청처리 흐름"></p>
<blockquote>
<p>응용 서비스는 도메인 모델을 이용해서 기능을 구현한다<br>
도메인 객체를 조회해야하거나 새로 생성해야 할 경우 리포지터리를 이용한다</p>
</blockquote>
<h1 id="인프라스트럭쳐"><a class="markdownIt-Anchor" href="#인프라스트럭쳐"></a> 인프라스트럭쳐</h1>
<p>표현, 응용, 도메인 영역을 모두 지원하는 영역이다<br>
DIP에서 언급했듯이 인프라스트럭쳐를 직접 사용하는 것 보단 각자의 영역에서 정의한 인터페이스를 인프라스트럭쳐 영역에서 구현하는 것이 시스템을 더 유연하고 테스트하기 쉽게 만들어준다</p>
<p>하지만 무조건 인프라스트럭쳐에 대한 의존을 없애는 것이 좋은 것은 아니다<br>
예를 들면 스프링의 <code>@Transactional</code>이 있다<br>
코드에서 스프링에 대한 의존을 없애려면 복잡한 스프링 설정을 사용해야하는데, 이럴때는 굳이 의존을 없애지 않는 것이 좋다<br>
<strong>구현의 편리함 또한 다른 장점들만큼 중요한 부분이기 때문이다</strong></p>
<blockquote>
<p>표현 영역 또한 인프라스트럭쳐와 쌍을 이룬다. 그것도 항상.</p>
</blockquote>
<h1 id="모듈-구성"><a class="markdownIt-Anchor" href="#모듈-구성"></a> 모듈 구성</h1>
<p>기본적으로 우리는 항상 아키텍쳐가 각 영역의 별도 패키지에 위치하는 형태로 구성한다</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">com.bookstore.ui</span><br><span class="line">com.bookstore.application</span><br><span class="line">com.bookstore.domain</span><br><span class="line">com.bookstore.infrastructure</span><br></pre></td></tr></table></figure>
<blockquote>
<p>애그리거트의 모델과 리포지터리는 같은 패키지에 위치시킨다</p>
</blockquote>
<p>하지만 패키지 구성 방식에 정답이 있는것은 아니다</p>
<p>도메인이 크면 하위 도메인마다 별도 패키지를 구성할 수 있다</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">com.bookstore.catelog.ui</span><br><span class="line">com.bookstore.catelog.application</span><br><span class="line">com.bookstore.catelog.domain</span><br><span class="line">com.bookstore.catelog.infrastructure</span><br><span class="line"></span><br><span class="line">com.bookstore.order.ui</span><br><span class="line">com.bookstore.order.application</span><br><span class="line">com.bookstore.order.domain</span><br><span class="line">com.bookstore.order.infrastructure</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>만약 카탈로그 도메인이 상품 애그리거트와 카테고리 애그리거트로 구성된다면 domain에서 패키지를 나눌 수 있다</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">com.bookstore.catelog.ui</span><br><span class="line">com.bookstore.catelog.application</span><br><span class="line">com.bookstore.catelog.domain.product</span><br><span class="line">com.bookstore.catelog.domain.category</span><br><span class="line">com.bookstore.catelog.infrastructure</span><br></pre></td></tr></table></figure>
<p>만약 도메인 서비스 계층이 따로 있으면 아래와 같이 나눌수도 있다</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.bookstore.catelog.domain.product</span><br><span class="line">com.bookstore.catelog.domain.category</span><br><span class="line">com.bookstore.catelog.domain.service</span><br></pre></td></tr></table></figure>
<blockquote>
<p>service는 product와 category 의 도메인 서비스 계층이다</p>
</blockquote>
<p>이러한 룰들은 domain 뿐만이 아니라 다른 계층에도 적용될 수 있다<br>
그리고 알다시피, 모듈 구성에 정답은 없다<br>
하지만 가능하면 한 패키지내에 10개 미만으로 타입 개수를 유지하는 것이 좋다</p>
<p>참고 : <a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;mallGb=KOR&amp;barcode=9788993827446&amp;orderClick=LAH&amp;Kc=" rel="external nofollow noopener noreferrer" target="_blank">최범균, 『DDD Start!』, 지앤선(2016)</a></p>
<a id="more"></a>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/DDD-start/" rel="tag"># DDD start!</a>
          
            <a href="/tags/계층-구조/" rel="tag"># 계층 구조</a>
          
            <a href="/tags/DIP/" rel="tag"># DIP</a>
          
            <a href="/tags/DI/" rel="tag"># DI</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/refactoring/필드-캡슐화/" rel="next" title="필드 캡슐화">
                <i class="fa fa-chevron-left"></i> 필드 캡슐화
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/refactoring/필드-자체-캡슐화/" rel="prev" title="필드 자체 캡슐화">
                필드 자체 캡슐화 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">JunYoung Park</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">182</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">344</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/feed.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#4개의-영역"><span class="nav-number">1.</span> <span class="nav-text"> 4개의 영역</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#계층-구조-아키텍쳐"><span class="nav-number">2.</span> <span class="nav-text"> 계층 구조 아키텍쳐</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#dip"><span class="nav-number">3.</span> <span class="nav-text"> DIP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dip-주의사항"><span class="nav-number">3.1.</span> <span class="nav-text"> DIP 주의사항</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#도메인-영역의-주요-구성요소"><span class="nav-number">4.</span> <span class="nav-text"> 도메인 영역의 주요 구성요소</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#엔티티와-벨류"><span class="nav-number">4.1.</span> <span class="nav-text"> 엔티티와 벨류</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#애그리거트"><span class="nav-number">4.2.</span> <span class="nav-text"> 애그리거트</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#리포지터리"><span class="nav-number">4.3.</span> <span class="nav-text"> 리포지터리</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#요청-처리-흐름"><span class="nav-number">5.</span> <span class="nav-text"> 요청 처리 흐름</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#인프라스트럭쳐"><span class="nav-number">6.</span> <span class="nav-text"> 인프라스트럭쳐</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#모듈-구성"><span class="nav-number">7.</span> <span class="nav-text"> 모듈 구성</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JunYoung Park</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> v3.6.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">NexT.Muse</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.0"></script>



  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  
  
  <script id="dsq-count-scr" src="https://joont92.disqus.com/count.js" async></script>


<script>
  var disqus_config = function() {
    this.page.url = "https://joont92.github.io/ddd/아키텍쳐/";
    this.page.identifier = "ddd/아키텍쳐/";
    this.page.title = '[ddd] 아키텍쳐';
    };
  function loadComments() {
    var d = document, s = d.createElement('script');
    s.src = 'https://joont92.disqus.com/embed.js';
    s.setAttribute('data-timestamp', '' + +new Date());
    (d.head || d.body).appendChild(s);
  }
  
    loadComments();
  
</script>





  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
